---
import BaseLayout from '../../../layouts/BaseLayout.astro';

const pageTitle = "수리 접수 완료";

const url = Astro.url;
const params = url.searchParams;

const customerInfo = {
  companyName: params.get('companyName'),
  address: params.get('address'),
  name: params.get('name'),
  phoneNumber: params.get('phoneNumber'),
  email: params.get('email'),
};

const products: any[] = [];
let i = 0;
while (params.get(`products[${i}][modelName]`)) {
  products.push({
    modelName: params.get(`products[${i}][modelName]`),
    lensSize: params.get(`products[${i}][lensSize]`),
    tempOption: params.get(`products[${i}][tempOption]`),
    geWindowToggle: params.get(`products[${i}][geWindowToggle]`) === 'on' ? '사용' : '미사용',
    geWindowSize: params.get(`products[${i}][geWindowSize]`),
    serialNumber: params.get(`products[${i}][serialNumber]`),
    purchaseDate: params.get(`products[${i}][purchaseDate]`),
    symptoms: params.get(`products[${i}][symptoms]`),
  });
  i++;
}

---

<BaseLayout pageTitle={pageTitle}>
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">수리 접수 완료</h1>

    <div class="bg-white p-6 rounded-lg shadow-md mb-8 print-container">
      <h2 class="text-2xl font-semibold mb-4">접수 내용</h2>

      <section class="mb-6">
        <h3 class="text-xl font-medium mb-2">고객 정보</h3>
        <p><strong>업체명:</strong> {customerInfo.companyName || '-'}</p>
        <p><strong>주소:</strong> {customerInfo.address || '-'}</p>
        <p><strong>이름:</strong> {customerInfo.name || '-'}</p>
        <p><strong>전화번호:</strong> {customerInfo.phoneNumber || '-'}</p>
        <p><strong>이메일:</strong> {customerInfo.email || '-'}</p>
      </section>

      {products.length > 0 && (
        <section>
          <h3 class="text-xl font-medium mb-4">제품 정보</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-300">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">#</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">모델명</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">렌즈 크기</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">온도 옵션</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Ge Window</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Ge Window 크기</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">시리얼 번호</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">구매 시기</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">증상</th>
                </tr>
              </thead>
              <tbody>
                {products.map((product, index) => (
                  <tr class="hover:bg-gray-50 border-b">
                    <td class="px-4 py-2 text-sm text-gray-800">{index + 1}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.modelName || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.lensSize || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.tempOption || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.geWindowToggle || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.geWindowSize || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.serialNumber || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.purchaseDate || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800 whitespace-pre-wrap">{product.symptoms || '-'}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </section>
      )}
    </div>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-8 no-print" role="alert">
      <p class="font-bold">물품 발송 안내</p>
      <p>이 페이지를 출력하여 물품에 동봉해주십시오.</p>
      <p>접수된 물건은 아래 주소로 보내주시기 바랍니다.</p>
      <p class="mt-2"><strong>받는 사람:</strong> 콕스</p>
      <p><strong>연락처:</strong> 02-857-3888</p>
      <p><strong>주소:</strong> 서울시 구로구 디지털로 242 한화비즈메트로 1차 810호</p>
    </div>

    <div class="flex justify-end no-print">
      <button onclick="window.print()" class="px-6 py-3 bg-blue-600 text-white rounded-md text-lg font-semibold hover:bg-blue-700">
        내용 출력
      </button>
    </div>
  </div>
</BaseLayout>

<style>
  @media print {
    /* Hide elements not needed for printing */
    .no-print, footer {
      display: none !important;
    }

    /* Ensure the main content container uses full width */
    .container {
      max-width: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    .print-container {
        box-shadow: none;
        border: 1px solid #ccc;
        margin: 0 !important;
    }

    /* General print adjustments */
    body {
      font-size: 10pt;
      color: #000;
    }

    h1, h2, h3, h4 {
        color: #000 !important;
    }

    /* Table specific styles for printing */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 9pt;
    }
    
    thead {
        background-color: #f2f2f2 !important;
    }

    th, td {
      border: 1px solid #ddd !important;
      padding: 4px;
      text-align: left;
      white-space: normal; /* Allow text to wrap */
      word-break: break-all;
    }
    
    th {
        font-weight: bold;
    }

    /* Remove background colors and ensure text is visible */
    .bg-gray-100 {
      background-color: #f2f2f2 !important;
      -webkit-print-color-adjust: exact; /* Chrome, Safari */
      color-adjust: exact; /* Firefox */
    }
    
    .text-gray-700, .text-gray-800 {
        color: #000 !important;
    }
  }
</style>