---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProductCard from '@/components/ProductCard.astro';
import SolutionCard from '@/components/SolutionCard.astro';
import HeroCarousel from '@/components/HeroCarousel.astro';
import { getCollection } from 'astro:content';

// Import Node.js file system modules
import fs from 'fs';
import path from 'path';

const featuredProducts = (await getCollection('products', p => p.data.lang === 'ko')).slice(0,3);
const featuredSolutions = (await getCollection('solutions', s => s.data.lang === 'ko')).slice(0,2);

// Dynamically get image paths for the carousel
const imagesDirectory = path.join(process.cwd(), 'public', 'assets', 'products', 'landing');
const imageFiles = fs.readdirSync(imagesDirectory).filter(file => {
  const ext = path.extname(file).toLowerCase();
  return ['.jpg', '.jpeg', '.png', '.gif', '.webp'].includes(ext);
});

const carouselImages = imageFiles.map(file => `/assets/products/landing/${file}`);
---
<BaseLayout title="COX Camera – 홈" lang="ko">
  <section class="relative bg-surface-1 text-on-surface py-24 mb-12 overflow-hidden shadow-lg w-full">
    <div class="text-center relative z-10">
      <h1 class="text-5xl md:text-6xl font-extrabold mb-4 leading-tight">정확한 열화상, 완벽한 솔루션</h1>
      <p class="text-xl md:text-2xl mb-10 opacity-90 max-w-3xl mx-auto whitespace-pre-wrap">
        온도 변화 모니터링, 침입 탐지, 조기 화재 감지 등<br class="hidden md:block"/>
        다양한 산업 분야에 최적화된 열화상 카메라와 솔루션을 제공합니다.
      </p>
      <a href="/ko/products" class="inline-block bg-primary text-on-primary font-semibold py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-shadow duration-300 text-lg">
        제품 살펴보기
      </a>
    </div>
    <HeroCarousel images={carouselImages} />
  </section>

  <section class="mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">주요 제품</h2>
    <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
      {featuredProducts.map(({ slug, data }) => (
        <ProductCard href={`/ko/products/${slug}`} name={data.name} shortDesc={data.name} img={data.heroImage} />
      ))}
    </div>
    <div class="text-center mt-10">
      <a href="/ko/products" class="inline-block text-primary font-semibold py-3 px-8 rounded-full border border-primary hover:bg-primary/10 transition-colors duration-300 text-lg">
        모든 제품 보기
      </a>
    </div>
  </section>

  <section class="mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">주요 솔루션</h2>
    <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
      {featuredSolutions.map(({ slug, data }) => (
        <SolutionCard href={`/ko/solutions/${slug}`} title={data.title} shortDesc={data.shortDesc} img={data.coverImage} />
      ))}
    </div>
    <div class="text-center mt-10">
      <a href="/ko/solutions" class="inline-block text-primary font-semibold py-3 px-8 rounded-full border border-primary hover:bg-primary/10 transition-colors duration-300 text-lg">
        모든 솔루션 보기
      </a>
    </div>
  </section>

  <section class="bg-surface-2 py-16 rounded-2xl shadow-md">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-6">왜 COX Camera인가?</h2>
      <p class="text-lg text-on-surface-variant max-w-2xl mx-auto mb-10">
        COX Camera는 혁신적인 열화상 기술과 고객 맞춤형 솔루션으로<br class="hidden md:block"/>
        귀사의 비즈니스에 새로운 가치를 더합니다.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="p-6 bg-surface-1 rounded-xl shadow-sm">
          <h3 class="text-xl font-semibold mb-3">정확성</h3>
          <p class="text-on-surface-variant">최첨단 센서 기술로 미세한 온도 변화까지 감지합니다.</p>
        </div>
        <div class="p-6 bg-surface-1 rounded-xl shadow-sm">
          <h3 class="text-xl font-semibold mb-3">안정성</h3>
          <p class="text-on-surface-variant">어떤 환경에서도 견고하게 작동하도록 설계되었습니다.</p>
        </div>
        <div class="p-6 bg-surface-1 rounded-xl shadow-sm">
          <h3 class="text-xl font-semibold mb-3">맞춤형 솔루션</h3>
          <p class="text-on-surface-variant">고객의 특정 요구에 맞춰 최적의 솔루션을 제공합니다.</p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>