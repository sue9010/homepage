---
import BaseLayout from '../../../layouts/BaseLayout.astro';

const pageTitle = "Repair Submission Complete";

const url = Astro.url;
const params = url.searchParams;

const customerInfo = {
  companyName: params.get('companyName'),
  address: params.get('address'),
  name: params.get('name'),
  phoneNumber: params.get('phoneNumber'),
  email: params.get('email'),
};

const products: any[] = [];
let i = 0;
while (params.get(`products[${i}][modelName]`)) {
  products.push({
    modelName: params.get(`products[${i}][modelName]`),
    lensSize: params.get(`products[${i}][lensSize]`),
    tempOption: params.get(`products[${i}][tempOption]`),
    geWindowToggle: params.get(`products[${i}][geWindowToggle]`) === 'on' ? 'Used' : 'Not Used',
    geWindowSize: params.get(`products[${i}][geWindowSize]`),
    serialNumber: params.get(`products[${i}][serialNumber]`),
    purchaseDate: params.get(`products[${i}][purchaseDate]`),
    symptoms: params.get(`products[${i}][symptoms]`),
  });
  i++;
}

---

<BaseLayout pageTitle={pageTitle}>
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Repair Submission Complete</h1>

    <div class="bg-white p-6 rounded-lg shadow-md mb-8 print-container">
      <h2 class="text-2xl font-semibold mb-4">Submission Details</h2>

      <section class="mb-6">
        <h3 class="text-xl font-medium mb-2">Customer Information</h3>
        <p><strong>Company Name:</strong> {customerInfo.companyName || '-'}</p>
        <p><strong>Address:</strong> {customerInfo.address || '-'}</p>
        <p><strong>Name:</strong> {customerInfo.name || '-'}</p>
        <p><strong>Phone Number:</strong> {customerInfo.phoneNumber || '-'}</p>
        <p><strong>Email:</strong> {customerInfo.email || '-'}</p>
      </section>

      {products.length > 0 && (
        <section>
          <h3 class="text-xl font-medium mb-4">Product Information</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-300">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">#</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Model Name</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Lens Size</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Temp. Option</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Ge Window</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Ge Window Size</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Serial No.</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Purchase Date</th>
                  <th class="px-4 py-2 border-b text-left text-sm font-semibold text-gray-700">Symptoms</th>
                </tr>
              </thead>
              <tbody>
                {products.map((product, index) => (
                  <tr class="hover:bg-gray-50 border-b">
                    <td class="px-4 py-2 text-sm text-gray-800">{index + 1}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.modelName || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.lensSize || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.tempOption || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.geWindowToggle || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.geWindowSize || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.serialNumber || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">{product.purchaseDate || '-'}</td>
                    <td class="px-4 py-2 text-sm text-gray-800 whitespace-pre-wrap">{product.symptoms || '-'}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </section>
      )}
    </div>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-8 no-print" role="alert">
      <p class="font-bold">Shipping Information</p>
      <p>Please print this page and include it with your item(s).</p>
      <p>Please send the item(s) to the address below:</p>
      <p class="mt-2"><strong>Recipient:</strong> Cox Hasumin</p>
      <p><strong>Contact:</strong> 010-3462-1008</p>
      <p><strong>Address:</strong> Seoul, Guro-gu, Digital-ro 242, Hanwha Bizmetro 1st, 810ho</p>
    </div>

    <div class="flex justify-end no-print">
      <button onclick="window.print()" class="px-6 py-3 bg-blue-600 text-white rounded-md text-lg font-semibold hover:bg-blue-700">
        Print Details
      </button>
    </div>
  </div>
</BaseLayout>

<style>
  @media print {
    /* Hide elements not needed for printing */
    .no-print, footer {
      display: none !important;
    }

    /* Ensure the main content container uses full width */
    .container {
      max-width: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    .print-container {
        box-shadow: none;
        border: 1px solid #ccc;
        margin: 0 !important;
    }

    /* General print adjustments */
    body {
      font-size: 10pt;
      color: #000;
    }

    h1, h2, h3, h4 {
        color: #000 !important;
    }

    /* Table specific styles for printing */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 9pt;
    }
    
    thead {
        background-color: #f2f2f2 !important;
    }

    th, td {
      border: 1px solid #ddd !important;
      padding: 4px;
      text-align: left;
      white-space: normal; /* Allow text to wrap */
      word-break: break-all;
    }
    
    th {
        font-weight: bold;
    }

    /* Remove background colors and ensure text is visible */
    .bg-gray-100 {
      background-color: #f2f2f2 !important;
      -webkit-print-color-adjust: exact; /* Chrome, Safari */
      color-adjust: exact; /* Firefox */
    }
    
    .text-gray-700, .text-gray-800 {
        color: #000 !important;
    }
  }
</style>